# ADR: MVP — Открытие депозитов онлайн для банка "Стандарт"

**Название задачи:** MVP открытия депозитов онлайн (сайт и интернет-банк, ручная обработка в бэк-офисе)  
**Автор:** Киселев Олег  
**Дата:** 2025-09-20

---

### Функциональные требования


| № | Действующие лица / системы                                                    | Use Case                        | Описание (пошагово)                                                                                                                                                                                                                                                                                                                             |
|---|-------------------------------------------------------------------------------|---------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 | Незарегистрированный клиент, Сайт, Система кол-центра                         | Отправка заявки с сайта         | 1. Клиент на сайте видит варианты депозитов и актуальные ставки.<br> 2. Заполняет форму: Ф.И.О., телефон; согласие на обработку ПД. (TLS, валидация).<br> 3. Сайт передаёт заявку в систему кол-центра/интеграционный слой.<br> 4. Оператор кол-центра звонит клиенту, предлагает условия. Если успешно — заводит обращение в АБС.              |
| 2 | Авторизованный клиент, Интернет-банк, SMS-шлюз, Интеграционный слой, Бэк-офис | Подать заявку из интернет-банка | 1. Клиент залогинен в интернет-банке, видит продукты и персонализированную ставку.<br> 2. Выбирает счёт, сумму, подтверждает операцию SMS-кодом.<br> 3. Заявка создаётся и отправляется в очередь для ручной обработки в бэк-офисе.<br> 4. После обработки клиент получает SMS-уведомления о ставке и об открытии депозита.                     |
| 3 | Менеджер кол-центра, Система кол-центра, Интеграционный слой                  | Обработка заявки кол-центром    | 1. Менеджер кол-центра звонит клиенту и уточняет детали заявки.<br> 2. Менеджер кол-центра изучает наличие особых условий.<br> 3. Оставляет заявку в системе для передачи в бэк-офис                                                                                                                                                            |
| 4 | Оператор бэк-офиса, АБС, Интеграционный слой                                  | Обработка заявки в бэк-офисе    | 1. Оператор видит заявку в бэк-офисном интерфейсе.<br> 2. При необходимости запрашивает special rate у кредитного подразделения (через RBAC / процесс внутри АБС или Rate Service).<br> 3. Оператор фиксирует ставку в АБС (или вызывает API Rate Service), создаёт депозит в АБС.<br> 4. АБС инициирует отправку SMS-уведомления клиенту.      |
| 5 | Оператор бэк-офиса, Rate Service                                              | Управление ставками депозитов   | Оператор актуализирует ставки в бэк-офисном интерфейсе.|
| 6 | Незарегистрированный клиент, Сотрудник отделения                              | KYC / идентификация             | Для новых клиентов: после предварительной заявки клиент обязан прийти в отделение для проверки документов и подписания. Только после KYC депозит оформляется окончательно в АБС.                                                                                                                                                                |
| 7 | Сотрудники операционных команд, Система мониторинга                           | Мониторинг и оповещения         | Доступ к логам, метрикам, алертам по доступности, задержкам и ошибкам интеграций.                                                                                                                                                                                                                                                               |

### Нефункциональные требования

| №   | Требование                                                                                         |
|-----|----------------------------------------------------------------------------------------------------|
| 1   | Интернет-банк и интеграционный слой 99.9% SLA.                                                     |
| 2   | Визуальный отклик UI < 300 ms; p95 API < 300 ms для кешированных запросов.                         |
| 3   | Горизонтальная масштабируемость веб/интеграционного слоёв.                                         |
| 4   | Буферизация заявок при недоступности АБС.                                                          |
| 5   | TLS 1.2+, Шифорвание передачи, ПД, БД, бэкапов. RBAC и аудит доступа.                              |
| 6   | Минимизировать тяжёлые синхронные запросы к АБС Oracle. Кеш/реплика.                               |
| 7   | Использовать существующий SMS-шлюз/ядро; ограничить доработки подрядчика.                          |
| 8   | OpenAPI/Swagger для API, CI/CD, тесты, документация, runbooks.                                     |
| 9   | KYC — обязательная личная идентификация для новых клиентов перед открытием счета.                  |
| 10  | Использовать существующие технологии (MS SQL, Oracle, .NET, Java, React), Kafka, для MVP — адаптер. |
| 11  | Архитектура должна позволять в будущем автоматизировать полный цикл и перейти к микросервисам и Kafka. ||

## Решение

### C4 Диаграмма контекста 

```plantuml
@startuml Context
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

Person(customer, "Клиент", "Физическое лицо, использует сайт или интернет-банк")
Person(branch_staff, "Сотрудник отделения", "Фронт-офис")
Person(call_agent, "Оператор кол-центра", "Звонит клиенту, уточняет заявку/условия")
Person(backoffice_user, "Оператор бэк-офиса", "Бэк-офис")

System(web_site, "Сайт", "Web Application")
System(internet_bank, "Интернет-банк", "Web Application")
System(bank_system, "Система банка Стандарт", "")
System_Ext(telecom, "Телеком-оператор", "Отправка SMS")

Rel(customer, web_site, "Просмотр депозитов, отправка заявки")
Rel(customer, internet_bank, "Просмотр продуктов, подача заявки")
Rel(web_site, bank_system, "Отправка заявок")
Rel(internet_bank, bank_system, "API вызовы")
Rel(bank_system, call_agent, "Передача/получение заявок")
Rel(bank_system, telecom, "Отправка SMS")
Rel(backoffice_user, bank_system, "Операции открытия депозитов")
Rel(backoffice_user, bank_system, "Управление ставками")
Rel(call_agent, bank_system, "Работа с заявками")
Rel(branch_staff, bank_system, "KYC и финальная регистрация")
Rel(customer, branch_staff, "Взаимодействует лично")
Rel(call_agent, customer, "Звонит")

@enduml
```

### C4 Диаграмма контейнеров

```plantuml
@startuml Containers
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

Person(customer, "Клиент", "Использует сайт, интернет-банк")
System_Boundary(b_bank, 'Банк "Стандарт"') {

  Container(web_site, "Сайт", "React, PHP", "Публичная витрина, форма заявки")
  Container(internet_bank_app, "Интернет-банк", ".NET Framework 4.5", "UI + бизнес-логика")
  ContainerDb(internet_bank_db, "Интернет-банк DB", "MS SQL", "Хранение сессий, профилей")
  Container(integration_layer, "Integration Layer", "Java / .NET Core", "API Gateway, очередь")
  Container(message_broker, "Message Broker (Queue)", "Kafka", "Durable queue для заявок")
  Container(rate_service, "Rate Service", "Java/.NET + DB", "Справочник ставок, правила расчёта")
  Container(callcenter_ui, "Call Center UI", "React", "Интерфейс операторов")
  Container(callcenter_backend, "Call Center Backend", "Java Spring Boot", "Модуль CRM")
  ContainerDb(callcenter_db, "Call Center Database", "PostgreSQL", "")

  Container(abs_core, "АБС Core", "Oracle + PL/SQL", "Хранение счетов/договоров")
  ContainerDb(abs_replica, "АБС Read-Replica", "Oracle Replica/Redis", "Read-only")

  Container(sms_gateway, "SMS Gateway", "Integration", "Интеграция с телеком-оператором")
  Container(monitoring, "Monitoring", "Prometheus / ELK", "Логи, метрики, трейсы")

  Container(abs_client, "Десктоп-клиент АБС", "Delphi", "Рабочее место сотрудника бэк-офиса")
}

Container_Ext(telecom, "Телеком оператор", "отправка SMS")

Rel(customer, web_site, "просмотр, заявка (TLS)")
Rel(customer, internet_bank_app, "подача заявки, SMS подтверждение")
Rel(web_site, integration_layer, "REST (TLS)")
Rel(internet_bank_app, integration_layer, "Получение данных о депозитах")
Rel(internet_bank_app, internet_bank_db, "CRUD")
Rel(integration_layer, message_broker, "постановка заявки в очередь")
Rel(integration_layer, rate_service, "получение ставок")
Rel(message_broker, abs_core, "создание депозита")
Rel(abs_core, abs_client, "UI сотрудников")
Rel(abs_core, sms_gateway, "инициировать отправку SMS")
Rel(sms_gateway, telecom, "отправить SMS")
Rel(integration_layer, callcenter_backend, "заявки")
Rel(callcenter_backend, callcenter_db, "хранение данных о заявках")
Rel(callcenter_ui, callcenter_backend, "запросы о заявках")
Rel(integration_layer, monitoring, "метрики и логи")
Rel(integration_layer, abs_replica, "операции чтения")
Rel(abs_client, rate_service, "управление ставками")
Rel(abs_replica, abs_core, "read-only репликация")
Rel(sms_gateway, monitoring, "метрики и логи")
Rel(abs_core, monitoring, "метрики и логи")

@enduml
```

### **Альтернативы**

Альтернатива 1.

Прямая интеграция интернет-банка и сайта с АБС (без интеграционного слоя и очереди)  

Достоинства: 
- минимальные изменения в архитектуре
- проще реализовать
- быстрее запустить

Недостатки: 
- перегрузка АБС при росте онлайн-заявок
- низкая отказоустойчивость
- высокая зависимость от доступности и производительности АБС

Альтернатива 2.

Сразу внедрить Kafka как шину сообщений  

Достоинства: 
- современный и масштабируемый подход
- гибкая event-driven архитектура
- база для будущих цифровых сервисов  

Недостатки:
- текущая версия интернет-банка несовместима с Kafka, потребуется дополнительная интеграционная прослойка
- высокая стоимость и сроки для MVP

Альтернатива 3.   

Автоматизировать весь процесс открытия депозитов сразу (без участия бэк-офиса)  

Достоинства:
- сокращение операционных издержек
- быстрый опыт для клиента
- сразу достигается финальная цель бизнеса

Недостатки:
- высокая сложность и стоимость
- потребность в изменении правил безопасности и доступа к данным кредитного отдела
- риски регуляторных ограничений
- может сильно затянуть сроки MVP

Альтернатива 4.

Сохранить XLS-файлы

Достоинства: 
- минимум изменений для бэк-офиса
- быстрая реализация

Недостатки: 
- сохраняет ручной труд
- риск ошибок и рассинхронизации
- плохо масштабируется и тормозит цифровизацию

---

### Недостатки, ограничения, риски

- Депозиты всё равно открываются вручную бэк-офисом. Задержки и риск ошибок сохраняются.
- Ограниченное применение Kafka как временное решение приводит к техническому долгу 
- Остаётся старый стек интернет-банка, который ограничивает возможности интеграции с современными решениями и усложняет дальнейшую цифровую трансформацию
- Ставки хоть и вынесены в `Rates Service`, но расчёт персональных условий пока требует участия сотрудников
- Добавление интеграционного слоя, брокера сообщений, новых UI и сервисов повышает сложность сопровождения
- Если очередь реализована неверно, возможна перегрузка системы АБС
- Ошибки в KYC или хранении персональных данных могут привести к штрафам
- Риск утечки чувствительных данных при интеграции, особенно через сайт
- Требуется координация нескольких команд (банк, подрядчик интернет-банка, подрядчик кол-центра, SMS-оператор) и эта координация должна быть хорошо организована
- Недооценка SLA, отсутствие полноценного мониторинга и аварийных процедур приведёт к сбоям и репутационным потерям
- Ручная обработка заявок и ручной расчёт ставок оставляют систему уязвимой к человеческому фактору
